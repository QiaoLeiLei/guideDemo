{"version":3,"sources":["file:///Users/qiao/Documents/CreatorDemo/GuideDemo/assets/scripts/GuideLayer.ts"],"names":["_decorator","Component","Node","UITransform","Vec3","Label","ccclass","property","GuideLayer","start","showNextGuide","node","data","dialogLabel","string","isValid","parent","worldPos","getComponent","convertToWorldSpaceAR","position","pos","convertToNodeSpaceAR","maskNode","maskShade","subtract","x","y","z","typeDialog","str","split","dt","fire","update","deltaTime","length","timer","shift"],"mappings":";;;;;;;;;;;;;;;;AACSA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,K,OAAAA,K;;;;;;;OACnD;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBP,U;;4BAGjBQ,U,WADZF,OAAO,CAAC,YAAD,C,UAGHC,QAAQ,CAACL,IAAD,C,UAERK,QAAQ,CAACL,IAAD,C,UAERK,QAAQ,CAACF,KAAD,C,oCAPb,MACaG,UADb,SACgCP,SADhC,CAC0C;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,wCAStB,KATsB;;AAAA,yCAUtB,GAVsB;;AAAA,uCAWtB,EAXsB;;AAAA,sCAYzB,CAZyB;AAAA;;AActCQ,QAAAA,KAAK,GAAG,CACP;;AAEDC,QAAAA,aAAa,CAACC,IAAD,EAAaC,IAAb,EAA2B;AACpC,eAAKC,WAAL,CAAiBC,MAAjB,GAA2B,EAA3B;;AACA,cAAIH,IAAI,IAAIA,IAAI,CAACI,OAAb,IAAwBJ,IAAI,CAACK,MAAjC,EAAyC;AAAA;;AACrC,gBAAIC,QAAQ,4BAAGN,IAAI,CAACK,MAAL,CAAYE,YAAZ,CAAyBf,WAAzB,CAAH,0DAAG,sBAAuCgB,qBAAvC,CAA6DR,IAAI,CAACS,QAAlE,CAAf;;AACA,gBAAIH,QAAJ,EAAc;AAAA;;AACV,kBAAII,GAAG,4BAAG,KAAKV,IAAL,CAAUO,YAAV,CAAuBf,WAAvB,CAAH,0DAAG,sBAAqCmB,oBAArC,CAA0DL,QAA1D,CAAV;;AACA,kBAAII,GAAJ,EAAS;AACL,qBAAKE,QAAL,CAAcH,QAAd,GAAyBC,GAAzB;AACA,qBAAKG,SAAL,CAAeJ,QAAf,GAA0B,IAAIhB,IAAJ,CAAS,CAAT,EAAY,CAAZ,EAAe,CAAf,EAAkBqB,QAAlB,CAA2BJ,GAA3B,CAA1B;AACA,qBAAKR,WAAL,CAAiBF,IAAjB,CAAsBS,QAAtB,GAAiC,IAAIhB,IAAJ,CAASiB,GAAG,CAACK,CAAJ,GAAM,GAAf,EAAoBL,GAAG,CAACM,CAAJ,GAAQ,EAA5B,EAAgCN,GAAG,CAACO,CAApC,CAAjC;AACH;AAEJ;;AACD,iBAAKC,UAAL,CAAgBjB,IAAhB;AACH;AACJ;;AAEDiB,QAAAA,UAAU,CAACC,GAAD,EAAa;AACnB,eAAKA,GAAL,GAAWA,GAAG,CAACC,KAAJ,CAAU,EAAV,CAAX;AACA,eAAKC,EAAL,GAAU,CAAV;AACA,eAAKC,IAAL,GAAY,IAAZ;AACH;;AAEDC,QAAAA,MAAM,CAAEC,SAAF,EAAqB;AACvB,cAAI,CAAC,KAAKF,IAAN,IAAcE,SAAS,GAAG,GAA9B,EAAmC;AAC/B;AACH;;AACD,cAAI,CAAC,KAAKL,GAAL,CAASM,MAAd,EAAsB;AAClB,iBAAKH,IAAL,GAAY,KAAZ;AACA;AACH;;AACD,eAAKD,EAAL,IAAWG,SAAX;;AACA,cAAI,KAAKH,EAAL,IAAW,KAAKK,KAApB,EAA2B;AACvB,iBAAKL,EAAL,GAAU,CAAV;AACA,iBAAKnB,WAAL,CAAiBC,MAAjB,IAA2B,KAAKgB,GAAL,CAASQ,KAAT,EAA3B;AACH;AACJ;;AArDqC,O;;;;;iBAGrB,I;;;;;;;iBAEC,I;;;;;;;iBAEG,I","sourcesContent":["\nimport { _decorator, Component, Node, UITransform, Vec3, Label } from 'cc';\nconst { ccclass, property } = _decorator;\n\n@ccclass('GuideLayer')\nexport class GuideLayer extends Component {\n\n    @property(Node)\n    maskNode: Node = null!;\n    @property(Node)\n    maskShade: Node = null!;\n    @property(Label)\n    dialogLabel: Label = null!;\n\n    fire: boolean = false;//开始打字\n    timer: number = 0.1;//打字间隔\n    str: string[] = [];\n    dt: number = 0;\n\n    start() {\n    }\n\n    showNextGuide(node: Node, data: string) {\n        this.dialogLabel.string = ``;\n        if (node && node.isValid && node.parent) {\n            let worldPos = node.parent.getComponent(UITransform)?.convertToWorldSpaceAR(node.position);\n            if (worldPos) {\n                let pos = this.node.getComponent(UITransform)?.convertToNodeSpaceAR(worldPos);\n                if (pos) {\n                    this.maskNode.position = pos;\n                    this.maskShade.position = new Vec3(0, 0, 0).subtract(pos);\n                    this.dialogLabel.node.position = new Vec3(pos.x-100, pos.y - 80, pos.z)\n                }\n\n            }\n            this.typeDialog(data);\n        }\n    }\n\n    typeDialog(str :string){\n        this.str = str.split('');\n        this.dt = 0;\n        this.fire = true;\n    }\n\n    update (deltaTime: number) {\n        if (!this.fire || deltaTime > 0.5) {\n            return;\n        }\n        if (!this.str.length) {\n            this.fire = false;\n            return;  \n        }\n        this.dt += deltaTime;\n        if (this.dt >= this.timer) {\n            this.dt = 0;\n            this.dialogLabel.string += this.str.shift();\n        }\n    }\n}\n\n"]}